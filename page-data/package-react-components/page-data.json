{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/package-react-components/","result":{"data":{"site":{"siteMetadata":{"title":"NoSleep Javascript Blog"}},"markdownRemark":{"id":"5b377d0e-d592-564f-98a4-db0c0b4bdafa","excerpt":"Table of Contents Introduction: How to share React Components between Applications? To Inline or not to Inline Not-Inline Inline Theming Regular CSS Class Names…","html":"<h2 id=\"table-of-contents\" style=\"position:relative;\">Table of Contents<a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"header-anchor after\">#</a></h2>\n<div class=\"toc\">\n<ul>\n<li><a href=\"#introduction-how-to-share-react-components-between-applications\">Introduction: How to share React Components between Applications?</a></li>\n<li>\n<p><a href=\"#to-inline-or-not-to-inline\">To Inline or not to Inline</a></p>\n<ul>\n<li><a href=\"#not-inline\">Not-Inline</a></li>\n<li><a href=\"#inline\">Inline</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#theming\">Theming</a></p>\n<ul>\n<li><a href=\"#regular-css-class-names\">Regular CSS Class Names</a></li>\n<li><a href=\"#css-theme-variables\">CSS Theme variables</a></li>\n<li><a href=\"#inline-css-through-css-in-js\">Inline CSS (through CSS-in-JS)</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tldr-how-to-package-and-publish-front-end-libraries-in-2020\">TLDR: How to package and publish Front End libraries in 2020</a></p>\n<ul>\n<li><a href=\"#using-create-react-library\">Using create-react-library</a></li>\n</ul>\n</li>\n<li><a href=\"#closing\">Closing</a></li>\n<li>\n<p><a href=\"#appendix-1-how-to-use-peer-dependencies\">Appendix 1: How to use Peer Dependencies</a></p>\n<ul>\n<li><a href=\"#what-are-peer-dependencies\">What are Peer Dependencies?</a></li>\n<li><a href=\"#how-do-i-mark-a-dependency-as-a-peer-dependency\">How do I mark a dependency as a Peer Dependency?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#appendix-2-active-vs-passive-compilation\">Appendix 2: Active vs Passive compilation</a></p>\n<ul>\n<li><a href=\"#passive-compilation\">Passive Compilation</a></li>\n<li><a href=\"#active-compilation\">Active Compilation</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"introduction-how-to-share-react-components-between-applications\" style=\"position:relative;\">Introduction: How to share React Components between Applications?<a href=\"#introduction-how-to-share-react-components-between-applications\" aria-label=\"introduction how to share react components between applications permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>Check <a href=\"#tldr-how-to-package-and-publish-front-end-libraries-in-2020\">TLDR</a> if you don’t want all the\ndetails and just want the recommended solution.</p>\n</blockquote>\n<p>There are diverse situation in which we want to create an NPM package that contains\na <a href=\"https://reactjs.org/\">React</a> Component with CSS and images.</p>\n<p>This situation is particularly common inside companies that want to share components,\nand pieces of code in general, between apps usually inside a private NPM repository, but\nit also applies when authoring Open Source software like a single Component package such as a Date Picker\nor a Multi Select and also when authoring Component Libraries or UI Frameworks like <a href=\"https://react-bootstrap.github.io/\">React Bootstrap</a>,\n<a href=\"https://ant.design/\">Ant Design</a>, <a href=\"https://babeljs.io/\">Semantic UI</a>, <a href=\"https://material-ui.com/\">Material UI</a>, etc (more on these later).</p>\n<p>This problem might seem simple enough but it turns out that it has a lot of nuances and trade-offs.</p>\n<p>The main challenge in packaging a <a href=\"https://reactjs.org/\">React</a> Component is surprisingly not Javascript,\nbut all the Assets that might be related to that component such as CSS, Images, SVGs and fonts.\nThese assets are directly related to our Javascript code via some of the following statements:</p>\n<ul>\n<li><code class=\"language-text\">imports image from './image.{png,jpg,svg}'</code> in Javascript</li>\n<li><code class=\"language-text\">import classNames from './styles.{css,scss,less)'</code> in Javascript</li>\n<li><code class=\"language-text\">url(image.{png,jpg,svg})</code> in CSS</li>\n<li><code class=\"language-text\">font-family and @import</code> in CSS</li>\n</ul>\n<p><a href=\"https://webpack.js.org/\">Webpack</a> can understand all these dependency statements via <em>loaders</em> and completely\nanalyse the cross-language and cross-file-type dependency graph, which for a very simple\ncomponent might look something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">            --> styles.css --> otherImage.svg\nMyComponent --> image.svg</code></pre></div>\n<p>It turns out that there are a lot of schemes for representing this graph in a Packaged NPM module,\neach with its own trade-offs. Analysing each alternative is the main purpose of this post.</p>\n<p>Unfortunately in early 2020 there is still no universal standard way of <em>packaging a Front End</em> module with all\nits assets, but a lot of progress has been made and there are actually lots of promising solutions.</p>\n<p>We are going to explore how this problem is tackled in the wild by studying\neach technique and providing examples of real world, production-ready libraries that\nuse them and in the end of this post we are going\nto recommend a particular solution to this problem based of my experience.</p>\n<p>Additionally we are going to explore how each of these packaging schemes enable\ndifferent <strong>Theming</strong> schemes and, at the end, recommend one (<em>Theming</em> is a way of modifying the\nstyles of a set of components to fit your use case i.e. changing the buttons colors in a\nUI framework such as Bootstrap to fit your company’s graphics design spec).</p>\n<p>Most of this post is also applicable to any piece of Front End Javascript code that is related\nto CSS, images, etc, such as <a href=\"https://angular.io/\">Angular</a> Components / Directives, <a href=\"https://vuejs.org/\">Vue</a> Components, etc.</p>\n<h2 id=\"to-inline-or-not-to-inline\" style=\"position:relative;\">To Inline or not to Inline<a href=\"#to-inline-or-not-to-inline\" aria-label=\"to inline or not to inline permalink\" class=\"header-anchor after\">#</a></h2>\n<p>In the context of Front End assets, inlining means to bake those assets directly\ninto the Javascript code (bundle) generated by our bundlers or compilers such as Webpack or <a href=\"https://babeljs.io/\">Babel</a>.</p>\n<p>CSS can be inlined without any third party library by using the <code class=\"language-text\">style</code> HTML attribute,\nbut this has some limitations such as not being able to use pseudo selectors like <code class=\"language-text\">:hover</code>\nand media queries so, to enable all these regular CSS features\na third party <strong>CSS-in-JS</strong> library is recommended such as <a href=\"https://emotion.sh/docs/introduction\">Emotion</a>\nor <a href=\"https://www.styled-components.com/\">Styled-components</a> (more on this later).</p>\n<p>Images can be inlined by Webpack’s <a href=\"https://webpack.js.org/loaders/url-loader/\">url-loader</a> in the form of <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs\">Data URL</a> with Base64 encoding.\nSVG can be inlined by turning an <code class=\"language-text\">.svg</code> file into a <a href=\"https://reactjs.org/\">React</a> Component (An SVG file is just a regular HTML tree)\nor by using Webpack’s <a href=\"https://github.com/webpack-contrib/svg-inline-loader\">inline-svg-loader</a></p>\n<p>For a deeper exploration of how to deal with <code class=\"language-text\">svg</code> in React checkout this <a href=\"https://medium.com/@rossbulat/working-with-svgs-in-react-d09d1602a219\">post</a></p>\n<p>The main advantage of inlining is that after you bundle all your code base you end up with\na single Javascript file that contains all the dependencies it needs to run, even CSS and Images.</p>\n<p>This makes it <em>very</em> easy to package and publish to <a href=\"https://www.npmjs.com/\">NPM</a> and it makes very easy\nfor <strong>Component Consumers</strong> to <em>use</em> your module.</p>\n<p>Using <strong>CSS-in-JS</strong> libraries like <a href=\"https://emotion.sh/docs/introduction\">Emotion</a> or <a href=\"https://www.styled-components.com/\">Styled-components</a> makes up for a very\nnice <strong>Run-Time</strong> <strong>Theming</strong> API. Since everything is Javascript, your Themes are regular Javascript\nobject that can be composed or broken down into parts as any other regular JS object,\nand these can be altered at Run-Time, Themes can be composed, and they provide\na much simpler strategy than Build-Time CSS generated Themes like <a href=\"https://react-bootstrap.github.io/\">Bootstrap</a> or <a href=\"https://ant.design/\">Ant Design</a>.\n<a href=\"https://material-ui.com/\">Material UI React</a> uses a Run-Time Theme via a custom <strong>CSS-in-JS</strong> solution.</p>\n<p>Inlining is particularly useful for Component libraries or even UI Frameworks because\nthey tend to be mostly CSS heavy and with a couple of SVGs at most, both of which are efficiently\ninlined.</p>\n<p>Images are a bit more problematic because they are inlined in <a href=\"https://medium.com/snapp-mobile/dont-use-base64-encoded-images-on-mobile-13ddeac89d7c\">Base64</a> making them 30% bigger.</p>\n<p>In my experience, most Component Libraries do not tend to use an overabundance\nof images and if they do they usually are rather small.</p>\n<p>Most high resolution images are dynamic content that is usually dealt by\nApplications and not libraries, although libraries can render images, they do not\nship with those images since they are <em>Content</em> provided by APIs\nor static files in the App.</p>\n<p>The main drawback of inlining is that you turn multiple files that can\nbe fetched in parallel by the browser to a single larger file that cannot,\nthis will become more noticeable in larger code bases such as big Component Libraries\nor Applications.</p>\n<p>If you have a big enough library of components you might be able to break it\ninto independent chunks that can be dynamically imported by Applications,\nallowing more parallelism.\n<a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\">Dynamic imports</a> is a new Javascript feature that lets you express a dynamically loaded\ndependency that will be <em>fetched</em> and <em>interpreted</em> only when needed if needed at all.\nThis feature allows bigger and complex applications to reduce the initial load time by\nloading only what is necessary for the particular portion of the app that the user is interacting with.\nThis is actually not a super far fetched solution since dynamic imports\nare becoming <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import\">widely available</a> and Webpack has been making good\nprogress towards an easier configuration for multiple chunks.</p>\n<h3 id=\"not-inline\" style=\"position:relative;\">Not-Inline<a href=\"#not-inline\" aria-label=\"not inline permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors\" aria-label=\"as component authors permalink\" class=\"header-anchor after\">#</a></h4>\n<p>The configuration is pretty standard and you can use\nalready made solutions such as <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a>.</p>\n<p>You will end up with a bundle made of different files.</p>\n<p>A typical output might look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">/dist\n  - bundle.js\n  - bundle.css\n  images/\n    - dog.jpg</code></pre></div>\n<p>This is what you as an Author would publish to <a href=\"https://www.npmjs.com/\">NPM</a>.</p>\n<p><code class=\"language-text\">bundle.css</code> will use the image by doing <code class=\"language-text\">url(./images/dog.jpg)</code>, so\nboth files need to be served on the following URLs</p>\n<ul>\n<li><code class=\"language-text\">yourSite.com/public/bundle.css</code></li>\n<li><code class=\"language-text\">yourSite.com/public/images/dog.jpg</code></li>\n</ul>\n<p><code class=\"language-text\">public</code> can be any path with a trivial length, the important part is\nthat they are both served from <a href=\"https://stackoverflow.com/questions/940451/using-relative-url-in-css-file-what-location-is-it-relative-to\">the same path</a></p>\n<p>Aside from properly documenting how the files inside your package\nrelate to each other there is not much else you can do.</p>\n<p>You can also use this strategy by allowing access to your module via a CDN\n(<em>Content Delivery Network</em> use to load Javascript, CSS, etc from specialized servers, checkout <a href=\"https://unpkg.com/\">UNPKG</a>),\nby which <em>Component Consumers</em> can simply reference the module.</p>\n<h4 id=\"as-component-consumers\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers\" aria-label=\"as component consumers permalink\" class=\"header-anchor after\">#</a></h4>\n<p>This is where this approach has a hard time providing a good Consumer experience.</p>\n<p>Consumers need to:</p>\n<ul>\n<li><code class=\"language-text\">import module from 'module'</code> for Javascript, in every file that uses the module</li>\n<li>\n<p>Import the CSS by using either:</p>\n<ul>\n<li>A bundler like Webpack:</li>\n<li><code class=\"language-text\">import \"module.css\"</code> only once in your Application</li>\n<li>HTML link:</li>\n<li><code class=\"language-text\">cp ./node_modules/module/module.css ./public/images/dog.jpg</code>: copy the CSS file to your public directory</li>\n<li><code class=\"language-text\">&lt;link type=\"text/css\" rel=\"stylesheet\" href=\"public/module.css\"></code>: load the CSS in your page.</li>\n</ul>\n</li>\n<li>\n<p>Serve images at the path the module’s CSS and/or Javascript files expect them, in this case at <code class=\"language-text\">./images/dog.jpg</code></p>\n<ul>\n<li><code class=\"language-text\">cp ./node_modules/module/images/dog.jpg ./public/images/dog.jpg</code></li>\n<li>Serve <code class=\"language-text\">public/images/dog.jpg</code> by properly configuring your Application</li>\n</ul>\n</li>\n</ul>\n<p>We assume that <code class=\"language-text\">public</code> is your App’s public directory from where you serve your\nstatic files and assets, for convenience the directory is called <code class=\"language-text\">public</code> and the\nURL path is also called <code class=\"language-text\">public</code>.</p>\n<p>Notice how to <em>Consume</em> a simple module you need to do a lot of steps and\nwhile there are tools to automate the process such as <a href=\"https://webpack.js.org/\">Webpack</a>, <a href=\"https://gruntjs.com/\">Grunt</a>, <a href=\"https://gulpjs.com/\">Gulp</a>\nor a package like <a href=\"https://www.npmjs.com/package/npm-assets\">npm-assets</a>, the overall experience is not optimal.</p>\n<p>An obvious additional problem is potential <em>name conflicts</em>,\nfor example if two libraries need to serve <code class=\"language-text\">images/dog.jpg</code>.</p>\n<p><em>Component Authors</em> might make the module available via a CDN and that might\nremove the need to fiddle around with CSS and Images but you will need to\naccess the library via a <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/Global_object\">Browser Global</a> like the good old days, and by doing this\nyou are removing the possibility of bundling optimizations such as <a href=\"https://webpack.js.org/guides/tree-shaking/\">Tree Shaking</a> that\nwill become more and more common in the future.</p>\n<h3 id=\"inline\" style=\"position:relative;\">Inline<a href=\"#inline\" aria-label=\"inline permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors-1\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-1\" aria-label=\"as component authors 1 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>The Webpack configuration is about the same as with <strong>Not-inline</strong> and\nis actually not that hard and a working example\nwill be provided at the end of this post.</p>\n<p>You also will be able to use <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a> since it <a href=\"https://github.com/transitive-bullshit/create-react-library/issues/46\">inlines by default</a>.</p>\n<p>The key Webpack configuration is the inclusion of <a href=\"https://webpack.js.org/loaders/url-loader/\">url-loader</a> to\ninline images and files right into the final Javascript bundle.</p>\n<p>If you use <strong>CSS-in-JS</strong> libraries such as <a href=\"https://emotion.sh/docs/introduction\">Emotion</a> or <a href=\"https://www.styled-components.com/\">Styled-components</a> then\nyou will be able to use all the CSS features, plus compose them via Javascript and the\n<strong>Theming</strong> experience will be awesome.\nYou can easily create a Run-Time default Theme and provide\nhooks for <em>Component Consumers</em> to easily change it at Run-Time.</p>\n<p>For larger Component Libraries you will have a greater experience with writing\nand maintaining CSS. You will avoid completely some CSS exclusive problems such as:</p>\n<ul>\n<li>Global Scope and rule collisions.</li>\n<li>Specificity (inline-styles have maximum specificity, <strong>CSS-in-JS</strong> libraries simulate this).</li>\n<li>Style composition. I believe that regular Javascript object composition is better than CSS cascading global composition model, plus you can create a custom system that fits your team and your business logic (remember, it’s regular Javascript). You can easily publish your Themes as private NPM packages internally to shared them among Applications.</li>\n</ul>\n<p>While regular inline-styles will go a long way, you will most likely\nneed features that inline-styles do not provide and that regular CSS do such\nas pseudo selectors like <code class=\"language-text\">:hover</code> and media queries.\nTo solve this problem and provide better Developer Experience overall is that\n<strong>CSS-in-JS</strong> exists.</p>\n<p>I recommend going for <a href=\"https://emotion.sh/docs/introduction\">Emotion</a> or <a href=\"https://www.styled-components.com/\">Styled-components</a> since they\nare very mature and feature rich, have\ngood documentation and an active community.</p>\n<h4 id=\"as-component-consumers-1\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-1\" aria-label=\"as component consumers 1 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>Here is where the <strong>Inline</strong> approach <em>shines</em>.\nTo use a module with all its styles and assets such as images\nyou simply need to write a single line of code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> module <span class=\"token keyword\">from</span> <span class=\"token string\">\"module\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That is all!</p>\n<p>If you want to import the module dynamically (to parallelize and defer its loading\nin the client) the experience is very similar:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Inside some function or component</span>\n<span class=\"token keyword\">const</span> module <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">import</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"module\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>If you have Webpack configured correctly to create chunks that can be\ndynamically loaded, this is called <code class=\"language-text\">Code Splitting</code>, then <code class=\"language-text\">module</code>\nwill be an independent file lazy loaded, only when it is needed.</p>\n<p>Latest version of Webpack make this configuration almost trivial,\ncheck out their <a href=\"https://webpack.js.org/guides/code-splitting/\">docs</a>.</p>\n<p>This approach also works with the <em>Classic Way</em> of using dependencies via Browser Globals.</p>\n<h2 id=\"theming\" style=\"position:relative;\">Theming<a href=\"#theming\" aria-label=\"theming permalink\" class=\"header-anchor after\">#</a></h2>\n<p>For Component Libraries or UI Frameworks <strong>Theming</strong> is a <em>must</em>. They need to provide a way\nfor Component Consumers to change the default look of the components to fit\ntheir brand or their business.</p>\n<p>Let’s inspect different strategies of providing Theming and Customization hooks.</p>\n<h3 id=\"regular-css-class-names\" style=\"position:relative;\">Regular CSS Class Names<a href=\"#regular-css-class-names\" aria-label=\"regular css class names permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This approach works great for single or few component libraries but falls\nvery short for larger Component Libraries or UI Frameworks.</p>\n<p>The basic premise is that Consumers use well defined CSS class names\nto alter the Component’s looks.</p>\n<p>This approach works only at <strong>Run-Time</strong>.</p>\n<h4 id=\"as-component-author\" style=\"position:relative;\">As Component Author<a href=\"#as-component-author\" aria-label=\"as component author permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>You write regular CSS Classes (without CSS modules) and you relate them to your components via\n<code class=\"language-text\">className</code>.</li>\n<li>You can use LESS or SASS or any other CSS preprocessor.</li>\n<li>You should use Class Names naming conventions such as <a href=\"http://getbem.com/introduction/\">BEM</a> or <a href=\"http://smacss.com/\">SMACSS</a> among others.</li>\n<li>You <strong>cannot</strong> use CSS Modules since they generate pseudo random Class Names that cannot be used consistently by Consumers to customize or theme your components.</li>\n<li>You structure your classes carefully to allow Component Consumers to Theme or Customize your components styles by overriding some of those classes.</li>\n</ul>\n<h4 id=\"as-component-consumer\" style=\"position:relative;\">As Component Consumer<a href=\"#as-component-consumer\" aria-label=\"as component consumer permalink\" class=\"header-anchor after\">#</a></h4>\n<p>You use the Component Author provided class names to alter the component’s looks.</p>\n<h3 id=\"css-theme-variables\" style=\"position:relative;\">CSS Theme variables<a href=\"#css-theme-variables\" aria-label=\"css theme variables permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This approach is much more robust. The main premise is that Component Authors\nuse a set of well defined CSS, LESS or SASS variables to derive the rest of the styles.\nThese variables conform the Theme. Component Consumers can alter these variables\nto generate different looking themes.</p>\n<p>Examples of these are</p>\n<ul>\n<li><a href=\"https://ant.design/\">AntDesing</a></li>\n<li><a href=\"https://react-bootstrap.github.io/\">Bootstrap</a></li>\n<li><a href=\"https://react.semantic-ui.com/\">Semantic-UI</a></li>\n</ul>\n<p>This approach works only at <strong>Build-Time</strong> and <strong>may require a build system</strong>,\ndepending on whether you use CSS variables and target only supported browsers or\nyou use SASS, LESS or a transpiled version of CSS variables (i.e. using <a href=\"https://www.npmjs.com/package/postcss-css-variables\">this PostCss plugin</a>)</p>\n<h4 id=\"as-component-authors-2\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-2\" aria-label=\"as component authors 2 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>Carefully abstract the core theme variables and derive the rest of the styles from it.</li>\n<li>Provides a build system or build system integration documentation for Component Consumers to alter theme variables and compile new stylesheets.</li>\n<li>Works with or without CSS Modules.</li>\n</ul>\n<h4 id=\"as-component-consumers-2\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-2\" aria-label=\"as component consumers 2 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>\n<p>You will need to either:</p>\n<ul>\n<li>build an out of band StyleSheet with the Component Author’s provided build system ala Bootstrap or Ant Design.</li>\n<li>integrate Component’s Author build system into yours and build it in-band with the rest of your app.</li>\n</ul>\n</li>\n<li>Run-Time build is not possible and you must work around it.</li>\n</ul>\n<p><strong>Note</strong></p>\n<p><em>Out of band</em> and <em>in band</em> are terms I got from signal processing theory and in this case I’m using it to\ndescribe whether you build the StyleSheet in a separate build process and codebase (out of band)\nor you integrate the necessary build configurations into your own build process and codebase (in band).</p>\n<h3 id=\"inline-css-through-css-in-js\" style=\"position:relative;\">Inline CSS (through CSS-in-JS)<a href=\"#inline-css-through-css-in-js\" aria-label=\"inline css through css in js permalink\" class=\"header-anchor after\">#</a></h3>\n<p>This approach uses Core Theme Variables defined at Run-Time and\npassed through Javascript to components to alter their looks.</p>\n<p>It works well with the <strong>Inline</strong> Paradigm</p>\n<p>This approach works at <strong>Run-Time</strong> and does not require a build system.</p>\n<h4 id=\"as-component-authors-3\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-3\" aria-label=\"as component authors 3 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>Carefully abstract the core theme variables and derive the rest of the styles from it.</li>\n<li>Use CSS-in-JS libraries such as Emotion or styled-components.</li>\n<li>Use those libraries to provide theming hooks to Component Consumers.</li>\n</ul>\n<h4 id=\"as-component-consumers-3\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-3\" aria-label=\"as component consumers 3 permalink\" class=\"header-anchor after\">#</a></h4>\n<ul>\n<li>You must use the same CSS-in-JS libraries that the Component Author used.</li>\n<li>You simply define regular Javascript objects with core theme variables and pass them to Components.</li>\n</ul>\n<h2 id=\"tldr-how-to-package-and-publish-front-end-libraries-in-2020\" style=\"position:relative;\">TLDR: How to package and publish Front End libraries in 2020<a href=\"#tldr-how-to-package-and-publish-front-end-libraries-in-2020\" aria-label=\"tldr how to package and publish front end libraries in 2020 permalink\" class=\"header-anchor after\">#</a></h2>\n<p>This is my ideal setup for packaging and publishing\nFront End libraries such as React Components in 2020.</p>\n<p>This approach uses an Inline, Actively Compiled (see Appendix 2), Run-Time Theming model,\nthat uses the following technologies:</p>\n<ul>\n<li>React as the main component framework</li>\n<li>CSS-in-JS via Emotion</li>\n<li>Inline CSS via <strong>CSS-in-JS</strong> and the rest of the assets are inlined via Webpack’s <code class=\"language-text\">url-loader</code></li>\n<li>Webpack as the bundler</li>\n</ul>\n<p>Check the full <a href=\"https://github.com/franleplant/inline-react-package-example\">working source here</a></p>\n<p>To publish it to NPM:</p>\n<ul>\n<li>make sure you have the <code class=\"language-text\">package.json#main</code> file pointing to the output of your compilation, in this case <code class=\"language-text\">dist/index.js</code></li>\n<li>run <code class=\"language-text\">npm version patch | minor | major</code> to bump the version in <code class=\"language-text\">package.json</code> and create git tags</li>\n<li>run <code class=\"language-text\">npm publish</code></li>\n</ul>\n<p>Make sure you publish to the right NPM repository before doing it as most of the time\ncompanies do not want private packages to be publicly available by mistake.\nRead more <a href=\"https://docs.npmjs.com/misc/registry\">here</a></p>\n<p><strong>Webpack configuration</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// This is where we define the Inline magic.</span>\n<span class=\"token comment\">// This loader will turn all .svg, .jpg and .png files</span>\n<span class=\"token comment\">// into something that can be inlined in the final bundle</span>\n<span class=\"token keyword\">const</span> fileRules <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.(svg|jpg|png)$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  use<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      loader<span class=\"token operator\">:</span> <span class=\"token string\">\"url-loader\"</span><span class=\"token punctuation\">,</span>\n      options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// All files no matter what size</span>\n        limit<span class=\"token operator\">:</span> <span class=\"token number\">Infinity</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Pretty standard babel configurations for modern react apps</span>\n<span class=\"token keyword\">const</span> jsRules <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  test<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.jsx?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  exclude<span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n  use<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    loader<span class=\"token operator\">:</span> <span class=\"token string\">\"babel-loader\"</span><span class=\"token punctuation\">,</span>\n    options<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      presets<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"@babel/preset-env\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"@babel/preset-react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  entry<span class=\"token operator\">:</span> <span class=\"token string\">\"./src/index.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// Will defer minifaction to Applications bundler</span>\n  mode<span class=\"token operator\">:</span> <span class=\"token string\">\"development\"</span><span class=\"token punctuation\">,</span>\n  output<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    filename<span class=\"token operator\">:</span> <span class=\"token string\">\"index.js\"</span><span class=\"token punctuation\">,</span>\n    path<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"dist\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    libraryTarget<span class=\"token operator\">:</span> <span class=\"token string\">\"umd\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// Manually tell webpack about our \"peerDependencies\"</span>\n  <span class=\"token comment\">// that should not be included in the final bundle and</span>\n  <span class=\"token comment\">// will be provided by the Component Consumer, like an Application</span>\n  externals<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"react-dom\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"@emotion/core\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"@emotion/styled\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"emotion-theming\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  module<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>jsRules<span class=\"token punctuation\">,</span> fileRules<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><strong>Example Component with CSS-in-JS, inline assets and Theming</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">\"@emotion/styled\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ThemeProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"emotion-theming\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> dog1 <span class=\"token keyword\">from</span> <span class=\"token string\">\"./dog.jpg\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> dog2 <span class=\"token keyword\">from</span> <span class=\"token string\">\"./dog2.jpg\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> defaultTheme <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  colors<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    primary<span class=\"token operator\">:</span> <span class=\"token string\">\"blue\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use regular CSS features through CSS-in-JS</span>\n<span class=\"token comment\">// instrumented by Emotion</span>\n<span class=\"token keyword\">const</span> Container <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  margin: 10px;\n  padding: 10px;\n  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);\n  &amp; > div {\n    margin: 10px;\n  }\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> Name <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>span<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  font-weight: bold;\n  color: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> props<span class=\"token punctuation\">.</span>theme<span class=\"token punctuation\">.</span>colors<span class=\"token punctuation\">.</span>primary<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use the image from CSS-in-JS</span>\n<span class=\"token keyword\">const</span> Dog2 <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>div<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  background: center / contain no-repeat url(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>dog2<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">);\n  width: 100px;\n  height: 100px;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use the image from Javascript code</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Dog1</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>img src<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>dog1<span class=\"token punctuation\">}</span> width<span class=\"token operator\">=</span><span class=\"token string\">\"100\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">MyComponent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>ThemeProvider\n      theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">ancestorTheme <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"theme\"</span><span class=\"token punctuation\">,</span> ancestorTheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>defaultTheme<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>ancestorTheme <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Container<span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n          Im MyComponent<span class=\"token punctuation\">,</span> hi <span class=\"token operator\">&lt;</span>Name<span class=\"token operator\">></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Name<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> and\n          my color comes from a theme\n          <span class=\"token operator\">&lt;</span>br <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n          Here are some pictures <span class=\"token keyword\">of</span> dogs\n        <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n\n        <span class=\"token operator\">&lt;</span>Dog1 <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>Dog2 <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Container<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Component Consumer</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// In _real_ applications you would use it like this</span>\n<span class=\"token keyword\">import</span> MyComponent <span class=\"token keyword\">from</span> <span class=\"token string\">\"my-lib\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Theming API!</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ThemeProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"emotion-theming\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> appTheme <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  colors<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    primary<span class=\"token operator\">:</span> <span class=\"token string\">\"green\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>h1<span class=\"token operator\">></span>We are using MyComponent<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h1<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>p<span class=\"token operator\">></span>\n        It was Actively Compiled and now we can use it from\n        a Create React App Application\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>p<span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span><span class=\"token comment\">/* App defined theme at runtime */</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span>ThemeProvider theme<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>appTheme<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token operator\">&lt;</span>MyComponent name<span class=\"token operator\">=</span><span class=\"token string\">\"Luke Skywalker\"</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ThemeProvider<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Notes</strong></p>\n<ul>\n<li>make sure you have a single copy of <code class=\"language-text\">@emotion/core</code> in your final Application bundle to enable Theming. This is done by properly managing <code class=\"language-text\">peerDependencies</code> (more on this later).</li>\n<li>see it working in action in the linked repo.</li>\n</ul>\n<h3 id=\"using-create-react-library\" style=\"position:relative;\">Using create-react-library<a href=\"#using-create-react-library\" aria-label=\"using create react library permalink\" class=\"header-anchor after\">#</a></h3>\n<p>We can achieve the same by using <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a>, the library\ncode is the same and we remove the need for manually configuring Webpack, the\noutput bundle is slightly different since <em>create-react-library</em>\nuses <a href=\"https://rollupjs.org/\">Rollup</a> instead of Webpack.</p>\n<p>Checkout the code <a href=\"https://github.com/franleplant/inline-react-package-example-crl\">here</a>, I am using the vanilla configurations that create-react-library\nprovides with one exception:</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token deleted-sign deleted\"><span class=\"token prefix deleted\">-</span>  url(),\n</span><span class=\"token inserted-sign inserted\"><span class=\"token prefix inserted\">+</span>  url({limit: Infinity}),</span></code></pre></div>\n<p>This forces everything to be inlined no matter what is its size.</p>\n<h2 id=\"closing\" style=\"position:relative;\">Closing<a href=\"#closing\" aria-label=\"closing permalink\" class=\"header-anchor after\">#</a></h2>\n<p>Congratulations reading this far!</p>\n<p>You now know how to share code between different consumers such as Applications and\nwhen to apply each of the studied solutions.</p>\n<p>If you have any questions let me know!</p>\n<hr>\n<h2 id=\"appendix-1-how-to-use-peer-dependencies\" style=\"position:relative;\">Appendix 1: How to use Peer Dependencies<a href=\"#appendix-1-how-to-use-peer-dependencies\" aria-label=\"appendix 1 how to use peer dependencies permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p>TODO double check how we are handling externals</p>\n</blockquote>\n<p>As a <strong>Component Author</strong> you need to manage <strong>Peer Dependencies</strong> correctly to allow\n<strong>Component Consumers</strong> make the best possible final bundle avoiding duplication of dependencies\nbut also some libraries such as <code class=\"language-text\">React</code> and <code class=\"language-text\">Emotion</code> don’t work correctly if there are multiple versions\nof them running at the same time.</p>\n<h3 id=\"what-are-peer-dependencies\" style=\"position:relative;\">What are Peer Dependencies?<a href=\"#what-are-peer-dependencies\" aria-label=\"what are peer dependencies permalink\" class=\"header-anchor after\">#</a></h3>\n<p>Every dependency that <em>might</em> or <em>should</em> be shared by multiple libraries used by a single <strong>Component Consumer</strong>\nshould be treated as <strong>Peer Dependencies</strong>.</p>\n<p>Examples of obvious Peer Dependencies are</p>\n<ul>\n<li><code class=\"language-text\">react</code>: use by lots of components, breaks if there are more than one copy of it running</li>\n<li><code class=\"language-text\">lodash</code>: used by lots of libraries and components</li>\n<li><code class=\"language-text\">redux</code></li>\n<li><code class=\"language-text\">@emotion/core</code>: Theming breaks if you have more than one copy at the same time. <a href=\"https://github.com/emotion-js/emotion/issues/1479\">ref</a></li>\n</ul>\n<h3 id=\"how-do-i-mark-a-dependency-as-a-peer-dependency\" style=\"position:relative;\">How do I mark a dependency as a Peer Dependency?<a href=\"#how-do-i-mark-a-dependency-as-a-peer-dependency\" aria-label=\"how do i mark a dependency as a peer dependency permalink\" class=\"header-anchor after\">#</a></h3>\n<p>In your <code class=\"language-text\">package.json</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// These are dependencies your lib expects to be present in your</span>\n<span class=\"token comment\">// Component Consumer's context (i.e. the bundle)</span>\n<span class=\"token string\">\"peerDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"~16.0.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Most of the time you will need your peer dependencies</span>\n<span class=\"token comment\">// to be installed when testing your library.</span>\n<span class=\"token string\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"~16.0.0\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>Important</strong> make sure you are as wide as possible with the version ranges of your peer dependencies, this will\nallow your package, as a Component Author, to be used without frictions in more situations.</p>\n<p>In your <code class=\"language-text\">webpack.config.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// This tells webpack to not include these dependencies in the final bundle</span>\n<span class=\"token comment\">// since you expect them to be provided in the Component Consumer's context.</span>\nexternals<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"react\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"appendix-2-active-vs-passive-compilation\" style=\"position:relative;\">Appendix 2: Active vs Passive compilation<a href=\"#appendix-2-active-vs-passive-compilation\" aria-label=\"appendix 2 active vs passive compilation permalink\" class=\"header-anchor after\">#</a></h2>\n<blockquote>\n<p><strong>TLDR: Do not use <em>Passively compiled</em> dependecies ever!</strong></p>\n</blockquote>\n<p>I have seen situations in which packages are distributed raw,\nwithout being compiled before being published, this means <strong>Component Authors</strong>\npackage and distribute the raw sources like Typescript, ES2054, JSX, CSS Modules, etc.,\nand rely on <strong>Component Consumers</strong>, like Applications, to compile them usually\nby configuring Webpack to also treat <code class=\"language-text\">node_modules/my-raw-dependency</code>\nas part of the Application source.</p>\n<p>This is what I call <strong>Passive compilation</strong> because <strong>Component Authors</strong>\ndelegate their package compilation to the <strong>Component Consumers</strong>, instead\nof <strong>Active compilation</strong> in which each package is distributed already compiled\nby its <strong>Component Author</strong>.</p>\n<p>Today you can go a long way with Webpack abstractions like\n<a href=\"https://create-react-app.dev/\">Create React App</a> and <a href=\"https://www.npmjs.com/package/create-react-library\">Create React Library</a>, but you need to\ndo things in a fairly standard way and <strong>Passive Compilation</strong> is not at all\na standard way of distributing code.</p>\n<p>Check what the team behind <a href=\"https://github.com/facebook/create-react-app/issues/5103#issuecomment-425459196\">Create React App has to say about it</a>.</p>\n<p>It wouldn’t surprise me if other standardized high level build tools take a similar stand for\nreasons we are going to talk about more later.</p>\n<p>In my experience Webpack configurations are something that most developers\ndo not know or do not want to touch so\n<strong>having these sorts of abstractions inside\nyour company will save you a lot of trouble and maintenance,\nwhich translates to less operation costs</strong>.\nThese Webpack abstractions have lots of smart people working on them and\npouring their past experiences in creating something that will cover\nlots of use cases you probably won’t ever think of, so you are getting even\nmore things for free than you anticipate.</p>\n<p>Additionally, having custom Webpack configurations creates a potential\nopportunity to tightly couple other parts of your system like configurations,\nServices URLs, CDNs, PORT assignment, etc. to your Webpack build and configuration\nwhich makes it potentially brittle to any tweaks since it might affect some\ntightly coupled relationship in some obscure place. Relying on standard Webpack abstractions\nprovides a very clear interface where you can pass configuration values and custom behaviors\neffectively reducing this coupling.</p>\n<p>Finally, and with a more of a “business” look, it is much more\nefficient and effective to rely on pre-made solutions for Application bundling and compilation.\nWebpack and the other bundlers are hard to configure exactly right and as a company you will\nneed to maintain and bug fix your hand made configurations if you do them yourself.\nIt is effectively one more source of bugs you will have to deal with,\nso rely as much as possible on third party open source solutions and for that\nyou <em>must</em> avoid <strong>Passive Compilation</strong>.</p>\n<h3 id=\"passive-compilation\" style=\"position:relative;\">Passive Compilation<a href=\"#passive-compilation\" aria-label=\"passive compilation permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors-4\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-4\" aria-label=\"as component authors 4 permalink\" class=\"header-anchor after\">#</a></h4>\n<h5 id=\"advantages\" style=\"position:relative;\">Advantages<a href=\"#advantages\" aria-label=\"advantages permalink\" class=\"header-anchor after\">#</a></h5>\n<p>It is trivial to setup since you simply distribute your raw files.\nSome sort of an attempt at <strong>Active Compilation</strong> will be required\nif you want to unit test your library, but it could be a subset of the <em>real</em>\nconfiguration that <strong>Actively Compiling</strong> your library for distribution would require.</p>\n<p>It removes the need to think about distributing CSS because each <strong>Component Consumer</strong> (Applications)\nwill compile raw CSS modules or SASS or LESS into a single final bundle that will\ninclude your <strong>Passively Compiled</strong> dependency styles.</p>\n<p>Same goes for other assets such as fonts and images. Since Applications are treating\ndependencies as sources then all these things will be covered by whatever\nstrategy the Application’s Webpack configuration uses, like <code class=\"language-text\">file-loader</code>, etc.</p>\n<p>Providing a <strong>Theming</strong> API is also pretty simple as long as you have SASS or LESS\ncore variables that define your theme and from which the rest of the library’s\nstyles depend on and as long as the <strong>Component Consumers</strong> support these type of preprocessing.</p>\n<h5 id=\"disadvantages\" style=\"position:relative;\">Disadvantages<a href=\"#disadvantages\" aria-label=\"disadvantages permalink\" class=\"header-anchor after\">#</a></h5>\n<p>You must either specify or follow a specification of what Webpack loaders,\nloader configuration, CSS configuration, Babel configuration, etc. your library\nrequires in order for Apps to compile it successfully. You could also construct\nsome sort of Webpack composition hook but that can get really complicated really\nsoon without the proper care. An obvious problem with config composition is\nconflicts with a given loader configuration, such as Babel, where the App uses\ncertain configurations and the library uses others. In general I would say that\nthe library and the consumer App cannot have too different bundling configurations\nif they want to work properly together, which means of course <em>tight coupling</em>.</p>\n<p>You have less encouragement to create a library public API and\nsimply let <em>Component Consumers</em> use any of your library files\ndirectly i.e. <code class=\"language-text\">import something from 'A/src/some/deep/nested/file.js'</code>.</p>\n<p>This will make even harder to migrate your library to an <strong>Actively Compiled</strong>\nstrategy down the road because <em>Component Consumer</em> Apps will be tightly coupled\nto your library’s internal file structure and providing that same per-file API\nin Webpack is not trivial and has caveats (sharing code and such).</p>\n<p>By far, the <strong>biggest disadvantage</strong> with <strong>Passive compilation</strong> is that it will\n<strong>infect</strong> everything that it touches.\nIf you are creating a new package that is <strong>Actively compiled</strong>\nbut it uses some of the <strong>Passively compiled</strong> packages then BINGO,\nyou need to customize your package build to compile those <strong>passively compiled</strong>\npackages and you end up in a very similar situation than simply making\nyour new package <strong>Passively compiled</strong>. Which locks you down into this paradigm\nand all its flaws.</p>\n<p>I have been able to partially solve this situation by making those\n<strong>Passively compiled</strong> dependencies be <code class=\"language-text\">peerDependencies</code>, but you still need to\nhandle them somehow in a test environment (probably by mocking them entirely,\n<a href=\"https://jestjs.io/\">Jest</a> does make this fairly easy)\nand if you have any sort of playground or documentation page where\nyou display your component then BINGO again, you need to compile\n<strong>Passively compiled</strong> dependencies to make it work.</p>\n<p>If this seems crazy to you I can already tell you that I have\nexperienced this in my day to day Job and is super frustrating.</p>\n<h4 id=\"as-component-consumers-4\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-4\" aria-label=\"as component consumers 4 permalink\" class=\"header-anchor after\">#</a></h4>\n<h5 id=\"advantages-1\" style=\"position:relative;\">Advantages<a href=\"#advantages-1\" aria-label=\"advantages 1 permalink\" class=\"header-anchor after\">#</a></h5>\n<p>It is fairly easy to setup with some tweaks to the inclusion paths in your Webpack config.</p>\n<p><strong>Theming</strong> is easy because you just need to overwrite some SASS or LESS variables and your\nbuild system will do the rest.</p>\n<h5 id=\"disadvantages-1\" style=\"position:relative;\">Disadvantages<a href=\"#disadvantages-1\" aria-label=\"disadvantages 1 permalink\" class=\"header-anchor after\">#</a></h5>\n<p>You cannot use Webpack abstractions such as <a href=\"https://create-react-app.dev/\">Create React App</a>\nbecause you always need to customize the sources you include,\nand since this is a rather rare use case,\nmost abstractions won’t and probably should not provide this functionality.</p>\n<h3 id=\"active-compilation\" style=\"position:relative;\">Active Compilation<a href=\"#active-compilation\" aria-label=\"active compilation permalink\" class=\"header-anchor after\">#</a></h3>\n<h4 id=\"as-component-authors-5\" style=\"position:relative;\">As Component Authors<a href=\"#as-component-authors-5\" aria-label=\"as component authors 5 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>You actually need to write a full Webpack configuration\nto generate the bundle, but it is really not that bad (more on this later).</p>\n<p>Alternatively, you can use already made solutions such as <a href=\"https://www.npmjs.com/package/create-react-library\">create-react-library</a> et al.</p>\n<p>You will need to make decisions about how to package and distribute your\ncode which <em>is</em> exactly the main point of this post.</p>\n<h4 id=\"as-component-consumers-5\" style=\"position:relative;\">As Component Consumers<a href=\"#as-component-consumers-5\" aria-label=\"as component consumers 5 permalink\" class=\"header-anchor after\">#</a></h4>\n<p>You don’t need to customize your Webpack config to use the library,\nthis results in simpler configuration. You can also use standard\npre-made solutions such as <a href=\"https://create-react-app.dev/\">create-react-app</a></p>\n<p><strong>Theming</strong> will depend exclusively on what the <em>Component Author</em>\nsets up to be the Theming API. If a Component Author use\nsomething like <strong>CSS-in-JS</strong> then the experience will be pretty good.\n<a href=\"https://material-ui.com/\">Material-UI React</a> uses this API.</p>\n<p>If the Component Author provides a build to compile custom Themes\nout of band (outside your Apps build system) then it will be less\noptimal in my opinion.\n<a href=\"https://ant.design/\">Ant Design</a> and <a href=\"https://react-bootstrap.github.io/\">React Bootstrap</a> use this API.</p>","fields":{"slug":"/package-react-components/","readingTime":{"text":"25 min read"}},"frontmatter":{"title":"How to share React Components between Applications via NPM","date":"January 21, 2020","description":"In this post we explore in detail how to share React Components which are typically made of a bundle of Javascript, CSS (styles), Images, etc. We explore how to package and bundle the code with Webpack so that it can be published and distributed via a public or private NPM repository and later consumed appropriately. We also analyze different theming strategies for larger Component Libraries and UI Frameworks. And finally we provide a recommended way of packaging your Components in a simple and very flexible way.","tags":["React","Javascript","Typescript","CSS","Webpack","NPM","code sharing","publishing"],"seoFooter":null,"author":{"id":"franleplant","bio":"Tech Lead and Software developer with a degree in Engineering. Woodworker, all things Javascript, Rust and Software Architecture.","twitter":"franleplant","github":"https://github.com/franleplant","profilepicture":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAB2HAAAdhwGP5fFlAAACjUlEQVQ4y2P4jwH+/fsHJO/curV6xdKjhw9+//4NLogGGND4f//+BZKXL160MDVRUVLSUFZydbBbvHDBf2wAXfOfP3+AZENtjaWqVFGEx/L69HB7I3ERkUMHD8CNJmDzlo3rtrdn/Tww5/+p5Wtb8wUEBCZNnAA3GqdmiN9ePH86uTDmUG/h6vr0LT3Fdrqqpw8TYTNE89dPH84saL+3rPPlpinn5zcdn9Xw//sniDQ+zXCwdWLVqvL4iwtbTs6qPrd1KUgjqrXYNUMUndm9dk9P/obO/OkFYZeP7SVKM9DZf8GhcmDvriw/y3xvwy0tyetm9xw4fPT6tes/f/4iYDMwSJ88eRIREZ7oqDkh07cxL9HT1c3dw9va2nbv3v3IwcaAFlRv375taW0LDY2wtLZ0c7QzMzEys7T18w/KzMrOys5btmIlcmpjQNYJJFvbWgMCgyOjY3z9fH18/ULDIgoKivILimJi41NTUpOSU6/fuAm3nAE5bew9cNDR1T0qJiYkNAQIAgID0zOycnLzw8IjIyIiMzOz4uISdu3ag6IZYu3nz58mtdaWpkYFBwd4eXkFBASGhYUlJaeER0Z5eXsnJCSkpaVFRcVs2LABi+ZVyxafnVN3bUlzYrCHuZWVp6dHeHh4RGSUm7t7TEx0ampaRkYmMCw2bdqE0Ayhbt68GRcXN7+9/MrKnvq0MEtr26CgIP+AACtzE2cnR6CDMzKzkpJSQkPDb968hdAMSeuzZs92cnEODo+IiIqJjY2Ljo6JiYvPTolf3VGQnhgbGh4RFh7u6+tXXV2NHMBQzRMnTdTT03VydnRxdXVxdTMzM7GwsIgIDc5MjvPz9/f19fH29razs9+8eTNyPAMANpkgbLnsUSwAAAAASUVORK5CYII=","aspectRatio":1.1363636363636365,"src":"/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png","srcSet":"/static/3d0df698a9c84ca995878f7c2815d974/69585/franleplant-profile.png 200w,\n/static/3d0df698a9c84ca995878f7c2815d974/497c6/franleplant-profile.png 400w,\n/static/3d0df698a9c84ca995878f7c2815d974/edb0e/franleplant-profile.png 620w","sizes":"(max-width: 620px) 100vw, 620px"}}}}}}},"pageContext":{"slug":"/package-react-components/","previous":{"fields":{"slug":"/page-view-counter/"},"frontmatter":{"title":"Using Azure Functions to create a page view counter"}},"next":{"fields":{"slug":"/docker-essentials-for-front-end-developers/"},"frontmatter":{"title":"Essential Docker for Javascript and Front End Developers"}}}},"staticQueryHashes":["1000388668","1219926595","914163225"]}